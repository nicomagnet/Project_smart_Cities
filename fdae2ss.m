function [As, Bs] = fdae2ss(A, G, C, b, f)% nnodes = size(C,1); %n° total nodesnC = rank(C);       %n° nodes with capacityn0 = nnodes - nC;   %n° of nodes with zero capacitynq = size(A,1);K = -A'*G*A;K11 = K(1:n0,1:n0);K12 = K(1:n0,n0+1:end);K21 = K(n0+1:end,1:n0);K22 = K(n0+1:end,n0+1:end);Kb = A'*G;Kb1 = Kb(1:n0,:);Kb2 = Kb(n0+1:end,:);CC = C(n0+1:end,n0+1:end);As = inv(CC)*(-K21*inv(K11)*K12 + K22);Bs = inv(CC)*[-K21*inv(K11)*Kb1+Kb2 -K21*inv(K11) eye(nnodes-n0,nnodes-n0)];%Select relevant inputs and outputsBs = Bs(:,[b nq+f]); %inputs: [To To To Phiw Phii Phig Qh]% endfunction